<!DOCTYPE html><html><head><meta charset="utf-8"><title>Untitled Document.md</title><style></style></head><body id="preview">
<h1><a id="NETWORK_INTRUSION_DETECTION_USING_DIFFERENT_ALGORITHMS_0"></a><strong>NETWORK INTRUSION DETECTION USING DIFFERENT ALGORITHMS</strong></h1>
<p><strong>Programming Language Used</strong>: Python</p>
<p><strong>Executed on</strong>: Hadoop Big Data Platform</p>
<p><strong>Visualization Tool Used</strong>: Apache Zeppelin</p>
<h2><a id="OVERVIEW_8"></a>OVERVIEW</h2>
<p>This learning lab can be used as a guide to get a high level understanding of Machine learning application – Network intrusion detection using logistic regression. It also describes how to use Apache Spark functions and write interactive Python code from Zeppelin.</p>
<p>We will be using DevNet Data Learning Platform referred as “DLP” during the course.</p>
<h2><a id="PREREQUISITES_14"></a>PRE-REQUISITES</h2>
<ol>
<li>
<p>Install Chrome Browser.</p>
</li>
<li>
<p>Basic understanding of Apache Hadoop and Big Data.</p>
</li>
<li>
<p>Basic knowledge of Python.</p>
</li>
<li>
<p>Obtain access to Data Learning Platform -<br>
Refer: <a href="https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/WORD%20COUNT%20USING%20SCALA%20WITH%20APACHE%20SPARK/HowToAccessDTLP.md">https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/WORD COUNT USING SCALA WITH APACHE SPARK/HowToAccessDTLP.md</a></p>
</li>
</ol>
<h2><a id="LEARNING_OBJECTIVES_26"></a>LEARNING OBJECTIVES</h2>
<ol>
<li>
<p>To get familiarized with the DLP (Data Learning Platform).</p>
</li>
<li>
<p>To get familiarized with writing and executing Python code in Zeppelin.</p>
</li>
<li>
<p>To get familiarized with the concept of Machine Learning.</p>
</li>
<li>
<p>To get a basic understanding to build a network intrusion detector using different Machine Learning algorithms such as        Naive Bayes, SVM and Logistic Regression.</p>
</li>
<li>
<p>To get familiarized with Spark MLlib.</p>
</li>
</ol>
<h2><a id="TERMINOLOGIES_USED_38"></a>TERMINOLOGIES USED</h2>
<h3><a id="APACHE_ZEPPELIN__AN_INTRODUCTION_40"></a>APACHE ZEPPELIN - AN INTRODUCTION</h3>
<p>Zeppelin is a web-based notebook that enables interactive data analytics. You can make beautiful data-driven, interactive and collaborative documents with SQL, Scala and more.</p>
<p>Zeppelin enables data engineers, data analysts and data scientists to be more productive by developing, organizing, executing, and sharing data code and visualizing results without referring to the command line or knowing the cluster details. It brings data exploration, visualization, sharing and collaboration features to Spark. It supports Python and also a growing list of programming languages such as Scala, Hive, SparkSQL, shell and markdown. The various languages are supported via Zeppelin language interpreters. Zeppelin’s notebooks provides interactive snippet-at-time experience to data scientist.</p>
<h6><a id="Key_Features_46"></a>Key Features:</h6>
<ol>
<li>
<p>Web based notebook style editor.</p>
</li>
<li>
<p>Built-in Apache Spark support.</p>
</li>
</ol>
<h6><a id="Use_Cases_for_Zeppelin_52"></a>Use Cases for Zeppelin:</h6>
<ol>
<li>
<p>Data Exploration and discovery</p>
</li>
<li>
<p>Data Visualization - Tables, graphs and charts</p>
</li>
<li>
<p>Interactive snippet-at-a-time experience</p>
</li>
<li>
<p>Collaboration and publishing</p>
</li>
</ol>
<p>For more details, please refer : <a href="https://zeppelin.apache.org/">https://zeppelin.apache.org/</a></p>
<h3><a id="MACHINE_LEARNING__AN_INTRODUCTION_65"></a>MACHINE LEARNING - AN INTRODUCTION</h3>
<p>Machine learning is the subfield of computer science that gives computers the ability to learn without being explicitly programmed. It is evolved from the study of pattern recognition and computational learning theory in artificial intelligence. It is a type of Artificial Intelligence that facilitates a computer’s ability to learn and teach itself to evolve as it becomes exposed to new and ever-changing data. Machine learning is employed in a range of computing tasks where designing and programming explicit algorithms is infeasible.</p>
<h6><a id="Machine_Learning_Tasks_70"></a>Machine Learning Tasks</h6>
<ul>
<li>
<p>Classification, inputs are divided into two or more classes</p>
</li>
<li>
<p>Regression, the outputs are continuous rather than discrete.</p>
</li>
<li>
<p>Clustering, a set of inputs is to be divided into groups. Unlike in classification, the groups are not known beforehand, making this typically an unsupervised task.</p>
</li>
<li>
<p>Density estimation finds the distribution of inputs in some space.</p>
</li>
<li>
<p>Dimensionality reduction simplifies inputs by mapping them into a lower-dimensional space.</p>
</li>
</ul>
<h6><a id="Examples_of_Machine_Learning_Applications_83"></a>Examples of Machine Learning Applications</h6>
<ul>
<li>
<p>Network Intrusion</p>
</li>
<li>
<p>Speech Recognition</p>
</li>
<li>
<p>Image Recognition</p>
</li>
<li>
<p>Recommender systems</p>
</li>
<li>
<p>Autonomous driving etc.</p>
</li>
</ul>
<p>For more details, please refer:<br>
<a href="https://en.wikipedia.org/wiki/Machine_learning">https://en.wikipedia.org/wiki/Machine_learning</a></p>
<h2><a id="PROCESS_OVERVIEW_99"></a>PROCESS OVERVIEW</h2>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/WORD%20COUNT%20USING%20SCALA%20WITH%20APACHE%20SPARK/assets/images/Process11.jpeg?raw=true" alt="alt-tag"></p>
<p>Please follow the steps given below to launch the workspace and execute the program.</p>
<h3><a id="Step_1__Select_Learning_Lab_from_DLP_106"></a><strong>Step 1 : Select Learning Lab from DLP</strong></h3>
<p>After launching the DLP dashboard page, navigate to learning labs tab. Select the learning lab “Network intrusion detection using Logistic Regression” and click on “Start” button as shown in screenshot below:</p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection1.jpeg?raw=true" alt="alt-tag"></p>
<h3><a id="Step_2__Workspace_Page_112"></a><strong>Step 2 : Workspace Page</strong></h3>
<p>On click of Start button, user will be navigated to a workspace page where all the components, Tools and Microservices required to execute the program are available. Please refer the screenshot below:</p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection14.jpeg?raw=true" alt="alt-tag"></p>
<h3><a id="Step_3__Start_Service_in_Workspace_118"></a><strong>Step 3 : Start Service in Workspace</strong></h3>
<p>Points to Note:</p>
<ul>
<li>Start the Zeppelin service. Please refer screenshot below:</li>
</ul>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection3.jpeg?raw=true" alt="alt-tag"></p>
<ul>
<li>Once started, the colour of the icon changes to green and launch button is enabled.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection2.jpeg?raw=true" alt="alt-tag"></p>
<ul>
<li>If the task is in stopped status then click on it to start again.</li>
</ul>
<h3><a id="Step_4__Launch_Zeppelin_132"></a><strong>Step 4 : Launch Zeppelin</strong></h3>
<p>Click on launch button and user will be navigated to Zeppelin home page.</p>
<p>Points to note:</p>
<p>(The pop-up may be blocked in browser configuration. Click on the red pop up blocker icon and select **Always allow pop-up from <a href="http://xxx.xxx.xxx.xxx">http://xxx.xxx.xxx.xxx</a> ** and click on <strong>Done</strong> button.)</p>
<p><img src="https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/DATA%20EXPLORATION%2C%20ANALYSIS%20AND%20VISUALIZATION%20USING%20APACHE%20ZEPPELIN/assets/popUpBlockerAllowed1.jpeg?raw=true" alt="alt-tag"></p>
<p><img src="https://github.com/CiscoDevNet/data-dev-learning-labs/blob/master/labs/DATA%20EXPLORATION%2C%20ANALYSIS%20AND%20VISUALIZATION%20USING%20APACHE%20ZEPPELIN/assets/popUpBlockerAllowed2.jpeg?raw=true" alt="alt-tag"></p>
<p>On enabling the pop-up, Zeppelin would open in a new window taking the user to Zeppelin home page as shown in screenshot below.</p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection4.jpeg?raw=true" alt="alt-tag"></p>
<h3><a id="Step_5__Select_Zeppelin_notebook_149"></a><strong>Step 5 : Select Zeppelin notebook</strong></h3>
<ul>
<li>Select pre-created notebook - “Network Intrusion Detection using different algorithms” from home page as shown in screenshot below:</li>
</ul>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection12.jpeg?raw=true" alt="alt-tag"></p>
<ul>
<li>The Zeppelin interactive, development and visualization environment is now ready for use. The notebook - “Network Intrusion Detection Using Logistic Regression” has all the codes required for executing this learning lab. Each of the code shown below needs to be executed sequentially.</li>
</ul>
<h3><a id="Step_6__Execute_Python_Code_157"></a><strong>Step 6 : Execute Python Code</strong></h3>
<p>We are using code written in Python to build network intrusion detector using different Machine Learning algorithms.</p>
<p>The code is as follows:</p>
<p><strong>Download the Dataset</strong></p>
<pre><code class="language-json">%pyspark
import urllib
print 'Start downloading dataset'                                         
training_data_url = 'http://kdd.ics.uci.edu/databases/
kddcup99/kddcup.data_10_percent.gz'  #Print 'Start downloading dataset'
urllib.urlretrieve(training_data_url, 'kddcup.data_10_percent.gz')        
print 'kddcup.data_10_percent.gz is downloaded'
testing_data_url = 'http://kdd.ics.uci.edu/databases/
kddcup99/corrected.gz'
urllib.urlretrieve(testing_data_url, 'corrected.gz')
print 'corrected.gz is downloaded'
print 'Dataset Downloaded'
</code></pre>
<p><strong>Uncompress the Dataset</strong></p>
<pre><code class="language-json">%pyspark
import gzip
with gzip.open('kddcup.data_10_percent.gz', 'rb') as f:
training_raw_data = f.read()
with gzip.open('corrected.gz', 'rb') as f:
testing_raw_data = f.read()
</code></pre>
<p><strong>Data Preparation</strong></p>
<pre><code class="language-json">%pyspark

from pyspark.mllib.regression import LabeledPoint
#Split the training and testing dataset into data records
training_data = training_raw_data.split('\n')
testing_data = testing_raw_data.split('\n')

#In order to shorten the training time, select the first 10K data from training dataset 
for training, and Select the first 1K data from testing dataset for testing
training_data_rdd = sc.parallelize(training_data[:10000])
testing_data_rdd = sc.parallelize(testing_data[:1000])

#Set the label to 0 which are "normal" connection to 0, set the label to 1 which are not 
"normal" connection
training_data_rdd_labels = training_data_rdd.map(lambda line: line.split(','))
.map(lambda line: line[:41]+[0] 
if line[41] == 'normal.' else line[:41]+[1] )
testing_data_rdd_mapped_flag = testing_data_rdd.map(lambda line: line.split(','))
.map(lambda line: line[:41]+[0] 
if line[41] == 'normal.' else line[:41]+[1] )

#Transform the records from [feature0, feature1, ..., featureN, label] to LabledPoint(label, 
[feature0, feature4, 
..., featureN]), skip the second,third and fourth feature
training_data_rdd_clean = training_data_rdd_labels.map(lambda line:LabeledPoint(line[41], 
[float(line[0])]+[float(i) 
for i in line[4:41]]))

#Transform the records from [feature0, feature1, ..., featureN, label] to [feature0, 
feature4, ..., featureN], 
skip the second, third and fourth feature
testing_data_rdd_clean = testing_data_rdd_mapped_flag.map(lambda line:[float(line[0])]+[float(i) for i 
in line[4:41]])

#Extract the labels of testing dataset
testing_data_rdd_labels = testing_data_rdd_mapped_flag.map(lambda line:line[41])
</code></pre>
<p><strong>Select the algorithm</strong></p>
<pre><code class="language-json">%pyspark

#You can use different algorithms to train the model, they are Naive Bayes, Logistic Regression, SVM
value = z.select("Please select the Machine Learning algorithm:", [("1", "Naive Bayes"), 
("2", "Logistic Regression"), ("3", "SVM")], "1")
</code></pre>
<p><strong>Train the Logistic Regression Model</strong></p>
<pre><code class="language-json">%pyspark
model = None
if value == "1":
    from pyspark.mllib.classification import NaiveBayes, NaiveBayesModel
    model = NaiveBayes.train(training_data_rdd_clean, 1.0)
elif value == "2":
    from pyspark.mllib.classification import LogisticRegressionWithSGD, LogisticRegressionModel
    model = LogisticRegressionWithSGD.train(training_data_rdd_clean, iterations=100)
else:
    from pyspark.mllib.classification import SVMWithSGD, SVMModel
    model = SVMWithSGD.train(training_data_rdd_clean, iterations=100)
</code></pre>
<p><strong>Evaluate the performance of Logistic Regression Model</strong></p>
<pre><code class="language-json">%pyspark
prediction = lrm.predict(testing_data_rdd_clean)
prediction_true_pair = zip(prediction.collect(), testing_data_rdd_labels.collect())
accuracy = sc.parallelize(prediction_true_pair).filter(lambda (p, t): p == t).count() / (float)(testing_data_rdd_labels.count())
print 'Classification Accuracy: %f' % accuracy
</code></pre>
<p><strong>Following functions are being done by the Python Code :</strong></p>
<ol>
<li>
<p>Download the KDD 99 dataset for training data and testing data from internet</p>
</li>
<li>
<p>Uncompress KDD 99 dataset</p>
</li>
<li>
<p>Data Preparation</p>
<p>Split the training and testing dataset into data records.</p>
<p>In order to shorten the training time, select the first 10K data from training dataset for training, and<br>
select the first 1K data from testing dataset for testing.</p>
<p>Set the label to 0 which are “normal” connection to 0, set the label to 1 which are not “normal” connection.</p>
<p>Remove 2,3,4 features in training data and testing data.</p>
<p>Extract the labels of testing dataset.</p>
</li>
<li>
<p>Select the algorithm - the options available are Naive Bayes, Logistic Regression or SVM.</p>
</li>
<li>
<p>Train the model using the selected algorithm in previous step.</p>
</li>
<li>
<p>Evaluate the performance of the Model.</p>
</li>
<li>
<p>Select a different algorithm - Logistic Regression and repeat steps from 4-6 and compare the result.</p>
</li>
</ol>
<p>Execute the codes by clicking on the “Ready” icon highlighted as shown in screenshot below:</p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection7.jpeg?raw=true" alt="alt-tag"></p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection8.jpeg?raw=true" alt="alt-tag"></p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection9.jpeg?raw=true" alt="alt-tag"></p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection19.jpeg?raw=true" alt="alt-tag"></p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection10.jpeg?raw=true" alt="alt-tag"></p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection11.jpeg?raw=true" alt="alt-tag"></p>
<p>On successful execution of code, you can see the icon getting changed to “FINISHED” as shown in screenshot below:</p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection13.jpeg?raw=true" alt="alt-tag"></p>
<h3><a id="Step_7__View_Classification_Accuracy_309"></a><strong>Step 7 : View Classification Accuracy</strong></h3>
<p>The Naive Bayes Model shows a Classification Accuracy : 0.788000 as shown in screenshot below:</p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection15.png?raw=true" alt="alt-tag"></p>
<h3><a id="Step_8__Select_a_different_algorithm_and_Compare_Classification_Accuracy_316"></a><strong>Step 8 : Select a different algorithm and Compare Classification Accuracy</strong></h3>
<p>Select the algorithm - “Logistic Regression”. (Please refer Step 6 for more details).</p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection16.jpeg?raw=true" alt="alt-tag"></p>
<p>Train the model using the selected algorithm and evaluate the performance of the Model.</p>
<p>The logistic Regression Model shows a Classification Accuracy : 0.869000 as shown in screenshot below:</p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection18.png?raw=true" alt="alt-tag"></p>
<h3><a id="Step_9__Stop_Tasks_in_workspace_328"></a><strong>Step 9 : Stop Tasks in workspace</strong></h3>
<p>After executing the codes in Zeppelin, stop the task by clicking on <strong>Stop</strong> button in “Tools and Microservices” column. Please refer screenshot below:</p>
<p><img src="https://raw.githubusercontent.com/CiscoDevNet/data-dev-learning-labs/master/labs/NETWORK%20INTRUSION%20DETECTION%20USING%20DIFFERENT%20ALGORITHMS/assets/images/NetworkDetection17.jpeg?raw=true" alt="alt-tag"></p>
<h2><a id="LESSONS_LEARNT_334"></a>LESSONS LEARNT</h2>
<ol>
<li>
<p>How to write and execute Python code in Zeppelin.</p>
</li>
<li>
<p>How to build a Network intrusion detector using different Machine Learning algorithms such as Naive Bayes, SVM and Logistic    Regression.</p>
</li>
</ol>
<h1><a id="Congratulations_You_have_successfully_completed_the_Learning_Lab_341"></a><strong>Congratulations! You have successfully completed the Learning Lab!</strong></h1>

</body></html>